<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Speech Recognition</title>
	<link rel="stylesheet" href="">
</head>
<body>
		<h1>Hello World</h1>

			<p class="hints">Tap/click then say a color to change the background color of the app. Try <span style="background-color:aqua;"> aqua </span><span style="background-color:azure;"> azure </span><span style="background-color:beige;"> beige </span><span style="background-color:bisque;"> bisque </span><span style="background-color:black;"> black </span><span style="background-color:blue;"> blue </span><span style="background-color:brown;"> brown </span><span style="background-color:chocolate;"> chocolate </span><span style="background-color:coral;"> coral </span><span style="background-color:crimson;"> crimson </span><span style="background-color:cyan;"> cyan </span><span style="background-color:fuchsia;"> fuchsia </span><span style="background-color:ghostwhite;"> ghostwhite </span><span style="background-color:gold;"> gold </span><span style="background-color:goldenrod;"> goldenrod </span><span style="background-color:gray;"> gray </span><span style="background-color:green;"> green </span><span style="background-color:indigo;"> indigo </span><span style="background-color:ivory;"> ivory </span><span style="background-color:khaki;"> khaki </span><span style="background-color:lavender;"> lavender </span><span style="background-color:lime;"> lime </span><span style="background-color:linen;"> linen </span><span style="background-color:magenta;"> magenta </span><span style="background-color:maroon;"> maroon </span><span style="background-color:moccasin;"> moccasin </span><span style="background-color:navy;"> navy </span><span style="background-color:olive;"> olive </span><span style="background-color:orange;"> orange </span><span style="background-color:orchid;"> orchid </span><span style="background-color:peru;"> peru </span><span style="background-color:pink;"> pink </span><span style="background-color:plum;"> plum </span><span style="background-color:purple;"> purple </span><span style="background-color:red;"> red </span><span style="background-color:salmon;"> salmon </span><span style="background-color:sienna;"> sienna </span><span style="background-color:silver;"> silver </span><span style="background-color:snow;"> snow </span><span style="background-color:tan;"> tan </span><span style="background-color:teal;"> teal </span><span style="background-color:thistle;"> thistle </span><span style="background-color:tomato;"> tomato </span><span style="background-color:turquoise;"> turquoise </span><span style="background-color:violet;"> violet </span><span style="background-color:white;"> white </span><span style="background-color:yellow;"> yellow </span>.</p>
				
			<div class="clickMe">ClickMe</div>
			<div>
				<p class="output"></p>
			</div>
		</div>	
	<script>
		var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
		var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList
		var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent

		var colors = [ 'aqua' , 'azure' , 'beige', 'bisque', 'black', 'blue', 'brown', 'chocolate', 'coral', 'crimson', 'cyan', 'fuchsia', 'ghostwhite', 'gold', 'goldenrod', 'gray', 'green', 'indigo', 'ivory', 'khaki', 'lavender', 'lime', 'linen', 'magenta', 'maroon', 'moccasin', 'navy', 'olive', 'orange', 'orchid', 'peru', 'pink', 'plum', 'purple', 'red', 'salmon', 'sienna', 'silver', 'snow', 'tan', 'teal', 'thistle', 'tomato', 'turquoise', 'violet', 'white', 'yellow'];

		var grammar = '#JSGF V1.0; grammar colors; public <color> = ' + colors.join(' | ') + ' ;'

		var recognition = new SpeechRecognition();
		var speechRecognitionList = new SpeechGrammarList();
		speechRecognitionList.addFromString(grammar, 1);
		recognition.grammars = speechRecognitionList;
		//recognition.continuous = false;
		recognition.lang = 'en-US';
		recognition.interimResults = false;
		recognition.maxAlternatives = 1;

		var clickMe = document.querySelector('.clickMe');
		var diagnostic = document.querySelector('.output');
		var bg = document.querySelector('html');
		var hints = document.querySelector('.hints');

		var colorHTML= '';

		colors.forEach(function(v, i, a){
			//console.log(v, i);
			colorHTML += '<span style="background-color:' + v + ';"> ' + v + ' </span>';
		});

		hints.innerHTML = 'Tap/click then say a color to change the background color of the app. Try '+ colorHTML + '.';

		clickMe.onclick = function() {
			recognition.start();
			console.log('Ready to receive a color command.');
			diagnostic.innerHTML = 'Ready to recieve a colour command...';
		}

		recognition.onresult = function(event) {
			// The SpeechRecognitionEvent results property returns a SpeechRecognitionResultList object
			// The SpeechRecognitionResultList object contains SpeechRecognitionResult objects.
			// It has a getter so it can be accessed like an array
			// The [last] returns the SpeechRecognitionResult at the last position.
			// Each SpeechRecognitionResult object contains SpeechRecognitionAlternative objects that contain individual results.
			// These also have getters so they can be accessed like arrays.
			// The [0] returns the SpeechRecognitionAlternative at position 0.
			// We then return the transcript property of the SpeechRecognitionAlternative object
			console.log(event);

			var last = event.results.length - 1;
			var color = event.results[last][0].transcript;

			diagnostic.textContent = 'Result received: ' + color + '.';
			bg.style.backgroundColor = color;
			console.log('Confidence: ' + event.results[0][0].confidence);
		}

		recognition.onspeechend = function() {
			recognition.stop();
		}

		recognition.onnomatch = function(event) {
			diagnostic.textContent = "I didn't recognise that color.";
		}

		recognition.onerror = function(event) {
			diagnostic.textContent = 'Error occurred in recognition: ' + event.error;
		}
	</script>
</body>
</html>